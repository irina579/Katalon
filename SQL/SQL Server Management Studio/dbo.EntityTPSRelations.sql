;WITH source (EntityId, TPSEntityID, ValidFrom, ValidTo)
AS
(
    SELECT 2, 1001,  '2000-01-01', '2099-01-01'      UNION
    SELECT 2, 4001,  '2000-01-01', '2099-01-01'      UNION
    SELECT 2, 8001,  '2000-01-01', '2099-01-01'      UNION
    SELECT 2, 14001, '2000-01-01', '2099-01-01'      UNION

    SELECT 1001, 4001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 1001, 8001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 1001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 2001, 1001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 2001, 8001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 2001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 4001, 1001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 4001, 8001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 4001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 5001, 1001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 5001, 4001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 5001, 8001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 5001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 6001, 1001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 6001, 4001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 6001, 8001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 6001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 7001, 1001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 7001, 4001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 7001, 8001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 7001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 8001, 1001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 8001, 4001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 8001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 9001, 1001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 9001, 4001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 9001, 8001,  '2000-01-01', '2099-01-01'   UNION
    SELECT 9001, 14001, '2000-01-01', '2099-01-01'   UNION

    SELECT 10001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 10001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 10001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 10001, 14001, '2000-01-01', '2099-01-01'  UNION

    SELECT 11001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 11001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 11001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 11001, 14001, '2000-01-01', '2099-01-01'  UNION

    SELECT 12001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 12001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 12001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 12001, 14001, '2000-01-01', '2099-01-01'  UNION

    SELECT 13001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 13001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 13001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 13001, 14001, '2000-01-01', '2099-01-01'  UNION

    SELECT 14001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 14001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 14001, 8001,  '2000-01-01', '2099-01-01'  UNION

    SELECT 16001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 16001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 16001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 16001, 14001, '2000-01-01', '2099-01-01'  UNION

    SELECT 17001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 17001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 17001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 17001, 14001, '2000-01-01', '2099-01-01'  UNION

    SELECT 18001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 18001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 18001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 18001, 14001, '2000-01-01', '2099-01-01'  UNION

    SELECT 19001, 1001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 19001, 4001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 19001, 8001,  '2000-01-01', '2099-01-01'  UNION
    SELECT 19001, 14001, '2000-01-01', '2099-01-01'
)

MERGE dbo.EntityTPSRelations AS trg
USING source as src ON src.EntityId = trg.EntityId AND src.TPSEntityID = trg.TPSEntityID
WHEN NOT MATCHED THEN
    INSERT (EntityId, TPSEntityID, ValidFrom, ValidTo)
    VALUES (src.EntityId, src.TPSEntityID, ValidFrom, ValidTo)
WHEN NOT MATCHED BY source THEN
    DELETE;